<Page
    x:Class="ChaosSeed.WinUI3.Pages.TtsDebugPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ChaosSeed.WinUI3.Pages"
    xmlns:controls="using:ChaosSeed.WinUI3.Controls"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0">
            <Grid Padding="{StaticResource ChaosPagePadding}" RowSpacing="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.Transitions>
                    <TransitionCollection>
                        <EntranceThemeTransition FromVerticalOffset="10" />
                    </TransitionCollection>
                </Grid.Transitions>

                <StackPanel Grid.Row="0" Spacing="6">
                    <TextBlock Text="TTS（CosyVoice）调试" FontSize="28" FontWeight="SemiBold" />
                    <TextBlock
                        Text="通过 daemon 的 tts.sft.start/status/cancel 生成 WAV（只保存在内存里；选择保存后才落盘）。"
                        Opacity="0.8"
                        TextWrapping="Wrap" />
                </StackPanel>

                <muxc:InfoBar x:Name="StatusBar" Grid.Row="1" IsOpen="False" />

                <!-- Model / basic -->
                <Border Grid.Row="2" Style="{StaticResource ChaosCardBorderStyle}" Padding="16">
                    <StackPanel Spacing="10">
                        <TextBlock Text="模型与基础参数" FontSize="18" FontWeight="SemiBold" />

                        <TextBlock
                            Text="建议将导出的 pack 放在程序目录下：models/cosyvoice/pack（默认值）。如需更好的裁剪效果，请把 silero_vad.onnx 放到同一目录。"
                            Opacity="0.75"
                            TextWrapping="Wrap" />

                        <TextBox x:Name="ModelDirBox" PlaceholderText="modelDir（CosyVoice pack 目录）" TextWrapping="Wrap" />

                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBox x:Name="SpkIdBox" Width="220" PlaceholderText="spkId（如 dream）" />
                            <Button Content="选择模型目录" Click="OnPickModelDirClicked" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <CheckBox x:Name="AutoPlayToggle" Content="生成完成自动播放" IsChecked="True" />
                            <CheckBox x:Name="TextFrontendToggle" Content="textFrontend（基础归一化）" IsChecked="True" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Input -->
                <Border Grid.Row="3" Style="{StaticResource ChaosCardBorderStyle}" Padding="16">
                    <StackPanel Spacing="10">
                        <TextBlock Text="输入" FontSize="18" FontWeight="SemiBold" />

                        <TextBox
                            x:Name="InputTextBox"
                            PlaceholderText="输入要合成的文本"
                            TextWrapping="Wrap"
                            AcceptsReturn="True"
                            MinHeight="90" />

                        <TextBox
                            x:Name="PromptTextBox"
                            PlaceholderText="promptText（用于情绪/语气引导，需包含 &lt;|endofprompt|&gt;）"
                            TextWrapping="Wrap"
                            AcceptsReturn="True"
                            MinHeight="90" />

                        <muxc:Expander Header="高级参数" IsExpanded="False">
                            <StackPanel Spacing="10" Margin="0,10,0,0">
                                <ComboBox x:Name="PromptStrategyBox" Header="promptStrategy">
                                    <ComboBoxItem Content="inject" />
                                    <ComboBoxItem Content="guide_prefix" IsSelected="True" />
                                </ComboBox>

                                <TextBox x:Name="GuideSepBox" Header="guideSep" PlaceholderText="默认：。 " />

                                <Grid ColumnSpacing="12" RowSpacing="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <muxc:NumberBox x:Name="SpeedBox" Grid.Row="0" Grid.Column="0" Header="speed" Minimum="0.1" Maximum="3" SmallChange="0.05" SpinButtonPlacementMode="Compact" />
                                    <muxc:NumberBox x:Name="SeedBox" Grid.Row="0" Grid.Column="1" Header="seed" Minimum="0" Maximum="999999999" SmallChange="1" SpinButtonPlacementMode="Compact" />
                                    <muxc:NumberBox x:Name="TemperatureBox" Grid.Row="0" Grid.Column="2" Header="temperature" Minimum="0.001" Maximum="5" SmallChange="0.05" SpinButtonPlacementMode="Compact" />

                                    <muxc:NumberBox x:Name="TopPBox" Grid.Row="1" Grid.Column="0" Header="topP" Minimum="0.001" Maximum="1" SmallChange="0.01" SpinButtonPlacementMode="Compact" />
                                    <muxc:NumberBox x:Name="TopKBox" Grid.Row="1" Grid.Column="1" Header="topK" Minimum="1" Maximum="200" SmallChange="1" SpinButtonPlacementMode="Compact" />
                                    <muxc:NumberBox x:Name="WinSizeBox" Grid.Row="1" Grid.Column="2" Header="winSize" Minimum="1" Maximum="200" SmallChange="1" SpinButtonPlacementMode="Compact" />

                                    <muxc:NumberBox x:Name="TauRBox" Grid.Row="2" Grid.Column="0" Header="tauR" Minimum="0" Maximum="5" SmallChange="0.05" SpinButtonPlacementMode="Compact" />
                                </Grid>
                            </StackPanel>
                        </muxc:Expander>

                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Button x:Name="GenerateBtn" Content="生成" Click="OnGenerateClicked" />
                            <Button x:Name="CancelBtn" Content="取消" Click="OnCancelClicked" IsEnabled="False" />
                            <TextBlock x:Name="StageText" Text="stage: -" Opacity="0.75" VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>

        <controls:TtsMiniPlayerControl Grid.Row="1" Margin="{StaticResource ChaosPagePadding}" />
    </Grid>
</Page>
