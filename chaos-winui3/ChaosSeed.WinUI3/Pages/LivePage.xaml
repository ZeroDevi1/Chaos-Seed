<Page
    x:Class="ChaosSeed.WinUI3.Pages.LivePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ChaosSeed.WinUI3.Pages"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">

    <Grid Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border
            x:Name="ParsePanel"
            Grid.Row="0"
            CornerRadius="8"
            Padding="12"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <StackPanel Spacing="8">
                <TextBlock Text="输入直播间地址，点击解析开始播放并连接弹幕。" Opacity="0.8" />
                <Grid ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="InputBox" PlaceholderText="例如：https://live.bilibili.com/1 / douyu:xxx / huya:xxx" />
                    <Button x:Name="ParseBtn" Grid.Column="1" Content="解析" Click="OnParseClicked" />
                </Grid>
                <muxc:InfoBar x:Name="ParseStatusBar" IsOpen="False" />
            </StackPanel>
        </Border>

        <Grid Grid.Row="1" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition x:Name="SplitterCol" Width="6" />
                <ColumnDefinition x:Name="DanmakuCol" Width="280" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" CornerRadius="8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                <Grid>
                    <muxc:MediaPlayerElement
                        x:Name="SystemPlayer"
                        AreTransportControlsEnabled="False"
                        Visibility="Collapsed" />
                    <Image x:Name="VlcImage" Visibility="Collapsed" Stretch="Uniform" />

                    <muxc:InfoBar
                        x:Name="PlayerStatusBar"
                        IsOpen="False"
                        IsClosable="True"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Margin="12"
                        MaxWidth="720" />

                    <Button
                        x:Name="DanmakuToggleBtn"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0"
                        Click="OnToggleDanmaku"
                        Width="36"
                        Height="36">
                        <muxc:SymbolIcon x:Name="DanmakuToggleIcon" Symbol="Back" />
                    </Button>
                </Grid>
            </Border>

            <Border
                x:Name="DanmakuResizeHandle"
                Grid.Column="1"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="Transparent"
                PointerPressed="OnDanmakuResizePressed"
                PointerMoved="OnDanmakuResizeMoved"
                PointerReleased="OnDanmakuResizeReleased"
                PointerCanceled="OnDanmakuResizeReleased"
                PointerCaptureLost="OnDanmakuResizeReleased"
                ToolTipService.ToolTip="拖拽调整弹幕宽度" />

            <Border
                x:Name="DanmakuPane"
                Grid.Column="2"
                Margin="12,0,0,0"
                CornerRadius="8"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                <ListView x:Name="DanmakuList" ItemsSource="{x:Bind Rows, Mode=OneWay}">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="local:DanmakuRowVm">
                            <Grid Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{x:Bind DisplayText}" TextWrapping="NoWrap" />
                                <Image Grid.Column="1" Width="24" Height="24" Margin="8,0,0,0" Source="{x:Bind Emote, Mode=OneWay}" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>
        </Grid>
    </Grid>
</Page>
