<Page
    x:Class="ChaosSeed.WinUI3.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">

    <ScrollViewer>
        <Grid Padding="{StaticResource ChaosPagePadding}">
            <Grid.Transitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromVerticalOffset="10" />
                </TransitionCollection>
            </Grid.Transitions>
            <StackPanel Spacing="12">
                <TextBlock Text="设置" FontSize="28" FontWeight="SemiBold" />
                <TextBlock Text="提示：主题 / Backdrop / 直播后端 会自动持久化。" Opacity="0.8" />

                <Border Style="{StaticResource ChaosCardBorderStyle}" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="更新" FontSize="18" FontWeight="SemiBold" />

                        <TextBlock x:Name="UpdateCurrentVersionText" Text="当前版本：" Opacity="0.85" />

                        <muxc:InfoBar
                            x:Name="UpdatePackagedHint"
                            IsOpen="False"
                            Severity="Informational"
                            Title="提示"
                            Message="你正在使用 MSIX 安装版：更新由系统（AppInstaller）托管，此处无需自更新。" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="自动检测更新" VerticalAlignment="Center" />
                            <ToggleSwitch
                                x:Name="AutoUpdateToggle"
                                Grid.Column="1"
                                OffContent="关闭"
                                OnContent="开启"
                                Toggled="OnAutoUpdateToggled" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="检测间隔（小时）" VerticalAlignment="Center" />
                            <muxc:NumberBox
                                x:Name="AutoUpdateIntervalBox"
                                Grid.Column="1"
                                Minimum="1"
                                Maximum="336"
                                SmallChange="1"
                                SpinButtonPlacementMode="Compact"
                                ValueChanged="OnAutoUpdateIntervalChanged" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="检查更新" VerticalAlignment="Center" />
                            <Button
                                x:Name="CheckUpdateButton"
                                Grid.Column="1"
                                Content="检查"
                                Click="OnCheckUpdateClicked" />
                        </Grid>

                        <ProgressBar
                            x:Name="UpdateProgressBar"
                            Minimum="0"
                            Maximum="100"
                            Value="0"
                            Visibility="Collapsed" />

                        <TextBlock x:Name="UpdateStatusText" Text="" Opacity="0.85" TextWrapping="Wrap" />

                        <muxc:InfoBar
                            x:Name="UpdateInfoBar"
                            IsOpen="False"
                            Severity="Informational"
                            Title="更新"
                            Message="">
                            <muxc:InfoBar.ActionButton>
                                <Button x:Name="UpdateNowButton" Content="立即更新" Click="OnUpdateNowClicked" />
                            </muxc:InfoBar.ActionButton>
                        </muxc:InfoBar>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource ChaosCardBorderStyle}" Padding="16">
                    <StackPanel Spacing="12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="主题" VerticalAlignment="Center" />
                            <ComboBox x:Name="ThemeCombo" Grid.Column="1" SelectionChanged="OnThemeChanged">
                                <ComboBoxItem Content="跟随系统" Tag="FollowSystem" />
                                <ComboBoxItem Content="深色模式" Tag="Dark" />
                                <ComboBoxItem Content="浅色模式" Tag="Light" />
                            </ComboBox>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Backdrop（Win11）" VerticalAlignment="Center" />
                            <ComboBox x:Name="BackdropCombo" Grid.Column="1" SelectionChanged="OnBackdropChanged">
                                <ComboBoxItem Content="Mica（更像原生）" Tag="Mica" />
                                <ComboBoxItem Content="Mica Alt（更浅/更分层）" Tag="MicaAlt" />
                                <ComboBoxItem Content="无" Tag="None" />
                            </ComboBox>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="直播后端" VerticalAlignment="Center" />
                            <ComboBox x:Name="LiveBackendCombo" Grid.Column="1" SelectionChanged="OnLiveBackendChanged">
                                <ComboBoxItem Content="自动（优先 FFI）" Tag="Auto" />
                                <ComboBoxItem Content="FFI（chaos_ffi.dll）" Tag="Ffi" />
                                <ComboBoxItem Content="Daemon（chaos-daemon.exe）" Tag="Daemon" />
                            </ComboBox>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="歌词后端" VerticalAlignment="Center" />
                            <ComboBox x:Name="LyricsBackendCombo" Grid.Column="1" SelectionChanged="OnLyricsBackendChanged">
                                <ComboBoxItem Content="自动（优先 FFI）" Tag="Auto" />
                                <ComboBoxItem Content="FFI（chaos_ffi.dll）" Tag="Ffi" />
                                <ComboBoxItem Content="Daemon（chaos-daemon.exe）" Tag="Daemon" />
                            </ComboBox>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="歌词：自动检测" VerticalAlignment="Center" />
                            <ToggleSwitch
                                x:Name="LyricsAutoDetectToggle"
                                Grid.Column="1"
                                OffContent="关闭"
                                OnContent="开启"
                                Toggled="OnLyricsAutoDetectToggled" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="弹幕后端" VerticalAlignment="Center" />
                            <ComboBox x:Name="DanmakuBackendCombo" Grid.Column="1" SelectionChanged="OnDanmakuBackendChanged">
                                <ComboBoxItem Content="自动（优先 FFI）" Tag="Auto" />
                                <ComboBoxItem Content="FFI（chaos_ffi.dll）" Tag="Ffi" />
                                <ComboBoxItem Content="Daemon（chaos-daemon.exe）" Tag="Daemon" />
                            </ComboBox>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="直播：默认全屏播放" VerticalAlignment="Center" />
                            <ToggleSwitch
                                x:Name="LiveDefaultFullscreenToggle"
                                Grid.Column="1"
                                OffContent="关闭"
                                OnContent="开启"
                                Toggled="OnLiveDefaultFullscreenToggled" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="直播：全屏动画速率(x)" VerticalAlignment="Center" />
                            <muxc:NumberBox
                                x:Name="LiveFullscreenAnimRateBox"
                                Grid.Column="1"
                                Minimum="0.25"
                                Maximum="2.5"
                                SmallChange="0.1"
                                SpinButtonPlacementMode="Compact"
                                ValueChanged="OnLiveFullscreenAnimRateChanged" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="240" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="调试：显示播放提示" VerticalAlignment="Center" />
                            <ToggleSwitch
                                x:Name="DebugPlayerToggle"
                                Grid.Column="1"
                                OffContent="关闭"
                                OnContent="开启"
                                Toggled="OnDebugPlayerToggled" />
                        </Grid>

                        <muxc:InfoBar
                            x:Name="BackdropHint"
                            IsOpen="False"
                            Severity="Informational"
                            Title="提示"
                            Message="Backdrop 仅 Windows 11 生效；Windows 10 将自动降级为“无”。" />
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource ChaosCardBorderStyle}" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="歌曲下载" FontSize="18" FontWeight="SemiBold" />
                        <TextBlock Text="提示：网易云默认已内置可用的 API 列表；酷狗需要配置 API 才能启用。" Opacity="0.8" TextWrapping="Wrap" />

                        <Grid RowSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="420" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="酷狗 API baseUrl" VerticalAlignment="Center" />
                            <TextBox
                                x:Name="MusicKugouBaseUrlBox"
                                Grid.Row="0"
                                Grid.Column="1"
                                PlaceholderText="留空则禁用（例如：http://127.0.0.1:3000）"
                                LostFocus="OnMusicKugouBaseUrlLostFocus" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="网易云 API baseUrls" VerticalAlignment="Center" />
                            <TextBox
                                x:Name="MusicNeteaseBaseUrlsBox"
                                Grid.Row="1"
                                Grid.Column="1"
                                PlaceholderText="多个用 ; 分隔"
                                LostFocus="OnMusicNeteaseBaseUrlsLostFocus" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="网易云匿名 cookieUrl" VerticalAlignment="Center" />
                            <TextBox
                                x:Name="MusicNeteaseAnonUrlBox"
                                Grid.Row="2"
                                Grid.Column="1"
                                PlaceholderText="/register/anonimous"
                                LostFocus="OnMusicNeteaseAnonUrlLostFocus" />

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="每次下载都询问保存位置" VerticalAlignment="Center" />
                            <ToggleSwitch
                                x:Name="MusicAskOutDirToggle"
                                Grid.Row="3"
                                Grid.Column="1"
                                OffContent="关闭"
                                OnContent="开启"
                                Toggled="OnMusicAskOutDirToggled" />

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="下载路径模板" VerticalAlignment="Center" />
                            <StackPanel Grid.Row="4" Grid.Column="1" Spacing="4">
                                <TextBox
                                    x:Name="MusicPathTemplateBox"
                                    PlaceholderText="{}{{artist}}/{{album}}/{{title}} - {{artist}}.{{ext}}"
                                    LostFocus="OnMusicPathTemplateLostFocus" />
                                <TextBlock
                                    Text="变量：artist、album、title、ext、track_no（可选）；支持用 / 分隔文件夹。"
                                    Opacity="0.75"
                                    TextWrapping="Wrap" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>
