<Page
    x:Class="ChaosSeed.WinUI3.Pages.DownloadsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ChaosSeed.WinUI3.Pages"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">

    <Grid Padding="{StaticResource ChaosPagePadding}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Spacing="12">
            <TextBlock Text="下载" FontSize="28" FontWeight="SemiBold" />
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button Content="刷新" Click="OnRefreshClicked" />
                <TextBlock x:Name="HintText" Text="" Opacity="0.75" VerticalAlignment="Center" />
            </StackPanel>
            <muxc:InfoBar x:Name="InfoBar" IsOpen="False" />
        </StackPanel>

        <Grid Grid.Row="1" ColumnSpacing="12" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="420" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Sessions -->
            <Border Grid.Column="0" Style="{StaticResource ChaosCardBorderStyle}" Padding="12">
                <Grid RowSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Text="任务" FontWeight="SemiBold" />
                    <ListView
                        Grid.Row="1"
                        x:Name="SessionsList"
                        ItemsSource="{x:Bind Sessions, Mode=OneWay}"
                        SelectionChanged="OnSessionSelectionChanged">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="local:DownloadSessionListItemVm">
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="10" Padding="10" Margin="0,0,0,8">
                                    <StackPanel Spacing="6">
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock Text="{x:Bind Title}" FontWeight="SemiBold" TextWrapping="Wrap" />
                                            <TextBlock Text="{x:Bind State}" Opacity="0.75" VerticalAlignment="Center" />
                                        </StackPanel>
                                        <TextBlock Text="{x:Bind Totals}" Opacity="0.75" TextWrapping="Wrap" />
                                        <TextBlock Text="{x:Bind StartedAtText}" Opacity="0.6" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>

            <!-- Detail -->
            <Border Grid.Column="1" Style="{StaticResource ChaosCardBorderStyle}" Padding="12">
                <Grid RowSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12">
                        <TextBlock x:Name="DetailTitleText" Text="-" FontWeight="SemiBold" />
                        <TextBlock x:Name="DetailStateText" Text="" Opacity="0.75" VerticalAlignment="Center" />
                    </StackPanel>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12">
                        <Button x:Name="CancelBtn" Content="取消" Click="OnCancelClicked" />
                        <Button x:Name="OpenDirBtn" Content="打开目录" Click="OnOpenDirClicked" />
                        <Button x:Name="DeleteBtn" Content="删除记录" Click="OnDeleteClicked" />
                        <TextBlock x:Name="DetailMetaText" Text="" Opacity="0.7" VerticalAlignment="Center" TextWrapping="Wrap" />
                    </StackPanel>

                    <ListView
                        Grid.Row="2"
                        x:Name="JobsList"
                        ItemsSource="{x:Bind Jobs, Mode=OneWay}">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="local:DownloadJobListItemVm">
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="10" Padding="10" Margin="0,0,0,8">
                                    <Grid ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="120" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{x:Bind IndexText}" Opacity="0.7" />
                                        <TextBlock Grid.Column="1" Text="{x:Bind State}" />
                                        <StackPanel Grid.Column="2" Spacing="2">
                                            <TextBlock Text="{x:Bind Title}" FontWeight="SemiBold" TextWrapping="Wrap" />
                                            <TextBlock Text="{x:Bind Sub}" Opacity="0.75" TextWrapping="Wrap" />
                                            <TextBlock Text="{x:Bind Error}" Opacity="0.65" TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>

