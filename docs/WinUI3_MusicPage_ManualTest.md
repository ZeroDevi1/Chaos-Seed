# WinUI3「歌曲」页手动验收脚本

目标：验证“歌曲下载（QQ/酷狗/网易/酷我）”在 WinUI3 + daemon 链路下可用。

## 前置

- 使用 Windows 构建并启动 WinUI3（会自动拉起 `chaos-daemon.exe`）。
- 酷狗：需要在「设置」里配置可用的 API `baseUrl` 才能启用（留空则禁用）。
- 网易云：默认已内置一组可用的 API 列表；如遇不可用可在「设置」里覆盖。

## 用例 1：配置注入（可选）

1. 打开「歌曲」页
2. 如需启用酷狗 / 覆盖网易云：
   - 打开「设置」页
   - 设置酷狗 baseUrl、网易 baseUrls、网易 anonUrl

预期：
- 返回「歌曲」页后可正常搜索/下载

## 用例 2：QQ 登录（QQ 扫码 / 微信扫码）

1. 来源选择「QQ 音乐」
2. 点击「QQ 扫码登录」并扫码确认
3. 登录成功后点击「刷新 Cookie」
4. 点击「微信扫码登录」并扫码确认

预期：
- 两种扫码均可完成登录（状态显示“已登录：nick”）
- 刷新 Cookie 成功后仍保持可用登录态

## 用例 3：搜索（单曲/专辑/歌手）

1. 来源依次选择：QQ/酷我（以及已配置 baseUrl 的酷狗 / 网易）
2. （可选）来源选择「全部」
2. 搜索模式依次选择：单曲/专辑/歌手
3. 输入关键词并搜索

预期：
- 三种模式均可返回列表（无结果时为空列表，不崩溃）

## 用例 4：下载单曲（音质可选）

1. 搜索模式选「单曲」
2. 在列表中选择任意歌曲
3. 选择音质并点击「下载」

预期：
- 若未选择输出目录，会要求选择目录
- 下载任务出现在“下载任务”面板
- 可轮询更新进度；成功 job 显示 `done`
- 失败 job 显示明确错误（如登录失效/权限不足/接口未返回 URL）

## 用例 5：下载整张专辑 / 歌手全量

1. 搜索模式选「专辑」，点击「下载专辑」
2. 搜索模式选「歌手」，点击「下载全部」
3. 点击“取消”测试取消

预期：
- 专辑/歌手任务会创建下载会话并持续刷新 status
- 取消后任务尽快停止，并把未完成 job 标记为 `canceled`

## 文件结构验收

预期目录结构：

```text
<outDir>/
  Artist/
    Album/
      01 - Title.ext
```

无专辑信息时：

```text
<outDir>/
  Artist/
    Single/
      Title.ext
```
