# TODO_NEXT（近期 1~5 天交付）

> 说明：这里仅放“最近几天内必须交付”的 bugfix/小功能/风险修复。条目数量保持少（建议 3~6 个），但每条要写清：现象、实现方向（概括）、验收标准、回归清单。

> 当前进度提示：本仓库已进行一轮实现（包括：后台 runtime 独立线程 + UI 消息泵、回车搜索、单条下载按钮、主题按钮可见性、Windows 资源图标嵌入、panic 日志落地）。下面条目仍保留为 **Windows 11 侧验收/回归** 与可能的残留问题排查清单。

---

## P0-1 启动白屏 / 首屏延迟 2~3s（必须修）

### 现象（可复现）
- 打开 `.exe` 后先出现窗口与标题栏，但主界面内容没有立即渲染（可看到后面的窗口/像透明 client area）。
- 约 2~3 秒后首页内容才出现。

### 实现方向（概括）
- **做可观测**：记录关键阶段时间点（启动 → 创建窗口 → 进入事件循环 → 首次渲染/首个 tick）。
- **两条优先路径（先易后难）**：
  1) **首帧兜底**：确保窗口 client area 首帧就绘制不透明背景/骨架（避免透明导致“看见后面窗口”）。
  2) **避免 UI 线程阻塞**：把可能耗时的初始化（runtime/字体/模型构造/资源加载）延后到 event loop 启动后执行；首屏先显示 Loading/skeleton，完成后再切换完整 Home。
- 对比 software/skia renderer 的首帧耗时，仅用于诊断，不作为强依赖。

### 验收标准（可交付）
- 启动后 **<300ms** 可看到稳定的首屏（至少背景不透明 + 基础布局/Loading 文案）。
- 体感首屏可交互时间 **<1s**（后续再量化）。

### 回归清单
- Windows 原生：`cargo build --release`
- WSL -> windows-gnu：`cargo build --release --target x86_64-pc-windows-gnu`
- WSL -> windows-msvc（xwin）：`cargo xwin build --release --target x86_64-pc-windows-msvc`

---

## P0-2 搜索按钮点击后闪退（必须修）

### 现象（可复现）
- 点击“搜索”后应用直接退出（release 下更难看到错误）。

### 实现方向（概括）
- **禁止任何 panic 终止进程**：UI 回调链路中不允许 `unwrap/expect` 导致崩溃；错误必须转为可见提示（status 文本即可）。
- **错误可观测**：Debug 用 backtrace 定位；Release（`windows_subsystem`）也能看到“失败原因”（status 或日志文件）。
- **网络/解析/超时**：统一错误路径，busy 状态必复位。

### 验收标准（可交付）
- 任意关键词搜索：不崩溃。
- 网络错误/超时/接口返回异常：有清晰提示；busy 正确复位。

### 回归清单
- 同 P0-1
- 单元测试：输入校验（空 query、min_score 非数字、limit 边界）
- 集成测试：mock server 覆盖 code/result gate、超时/网络错误（不依赖真实迅雷接口）

---

## P0-3 字幕下载页交互重做（回车搜索 + 单条下载 + 每次选目录）

### 目标交互（锁定）
- 输入关键词后：
  - **回车触发搜索**（旁边保留“搜索按钮”）。
- 搜索结果展示为列表：
  - 每条结果右侧一个 **“下载”** 按钮（单条下载，不做多选/批量）。
- 点击某条“下载”：
  - **先弹出目录选择**（每条下载都要选目录，不复用上一次目录）。
  - 取消选择目录：不下载并提示。

### 实现方向（概括）
- UI：从“勾选多条 + 下载已选”切换到“每行下载按钮”。
- Rust 绑定：新增 `download_one(index)` 回调；目录选择在 UI 线程完成，确认后再异步下载。
- 状态呈现：MVP 先用全局 status（Downloading.../完成/失败），后续再做行级状态。

### 验收标准（可交付）
- 回车/点击搜索都能出列表。
- 点任意行下载：必弹目录选择；每次都弹；下载成功落地；失败可见。

### 回归清单
- 同 P0-1
- 单元测试：sanitize/unique path、下载重试/超时分支（mock server + 临时目录）

---

## P1-4 白天模式按钮不可见 + 输入框/说明不清晰

### 现象
- 白色模式下部分按钮“看不见/对比度不足”。
- 输入框未聚焦时不明显（只有点进去才显色），缺少清晰 label/说明。

### 实现方向（概括）
- 主题 token 补齐：button/input 的 bg/fg/hover/pressed/disabled 明确分离。
- 所有按钮/输入框使用统一的自定义组件（不依赖 std-widgets 默认配色）。
- 所有字段增加中文 label，并统一间距/对齐（Win11 风格基础）。

### 验收标准（可交付）
- 黑/白主题切换后：按钮始终可见；hover/pressed/disabled 状态清晰；输入框未点击也能看出边框与 label。

### 回归清单
- 同 P0-1

---

## P2-5 Windows 图标（Explorer/任务栏/Alt-Tab）

### 现象
- 生成的 `.exe` 没有应用图标。

### 实现方向（概括）
- 提供 `icon.ico` 资源文件。
- Windows 资源嵌入：`.rc + icon.ico`，并兼顾三种构建产物（win-msvc / wsl-gnu / wsl-xwin-msvc）。
- README/脚本补充验证点（确保产物图标一致可见）。

### 验收标准（可交付）
- Explorer/任务栏/Alt-Tab 图标一致显示自定义 icon（3 种构建产物均通过）。

### 回归清单
- 同 P0-1

---

## P2-6 About 链接 + 侧边栏 Win11 观感增强（小步快跑）

### 目标
- About 链接固定：`https://github.com/ZeroDevi1/Chaos-Seed`
- 侧边栏：折叠/展开动画更自然、icon 占位、选中态清晰（对标 wsl-dashboard 的“感觉”，不要求一比一）

### 验收标准（可交付）
- About 打开链接正确；侧边栏折叠/展开不卡顿、状态清晰。
